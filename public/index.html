<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Chem Laboratory | Login</title>
    
    <!-- Google Identity -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        }
        
        body { 
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            background: linear-gradient(135deg, #1a1f3c, #2d1b5e); 
            padding: 20px; 
        }
        
        .login-box { 
            width: 400px; 
            background: white; 
            padding: 40px; 
            border-radius: 15px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.3); 
        }
        
        .logo { 
            text-align: center; 
            margin-bottom: 30px; 
        }
        
        .logo h1 { 
            color: #3a2a7a; 
            font-size: 28px; 
            margin-bottom: 5px; 
        }
        
        .logo p { 
            color: #666; 
            font-size: 14px; 
        }
        
        .input-group { 
            margin-bottom: 20px; 
        }
        
        .input-group label { 
            display: block; 
            margin-bottom: 8px; 
            color: #333; 
            font-weight: 500; 
        }
        
        .input-group input { 
            width: 100%; 
            padding: 12px 15px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            font-size: 16px; 
            transition: 0.3s; 
        }
        
        .input-group input:focus { 
            border-color: #3a2a7a; 
            outline: none; 
            box-shadow: 0 0 0 3px rgba(58, 42, 122, 0.1); 
        }
        
        .btn { 
            width: 100%; 
            padding: 14px; 
            border: none; 
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: 0.3s; 
            margin-top: 10px; 
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #3a2a7a, #8a7dff); 
            color: white; 
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(58, 42, 122, 0.3); 
        }
        
        .btn-secondary { 
            background: #f5f5f5; 
            color: #333; 
        }
        
        .btn-secondary:hover { 
            background: #e9e9e9; 
        }
        
        .divider { 
            text-align: center; 
            margin: 25px 0; 
            color: #888; 
            font-size: 14px; 
            position: relative; 
        }
        
        .divider::before, 
        .divider::after { 
            content: ''; 
            position: absolute; 
            top: 50%; 
            width: 45%; 
            height: 1px; 
            background: #eee; 
        }
        
        .divider::before { 
            left: 0; 
        }
        
        .divider::after { 
            right: 0; 
        }
        
        .google-btn-container { 
            margin-bottom: 25px; 
        }
        
        .message { 
            text-align: center; 
            margin-top: 20px; 
            padding: 10px; 
            border-radius: 5px; 
            font-size: 14px; 
            display: none; 
        }
        
        .error { 
            background: #ffebee; 
            color: #c62828; 
            border: 1px solid #ffcdd2; 
        }
        
        .success { 
            background: #e8f5e9; 
            color: #2e7d32; 
            border: 1px solid #c8e6c9; 
        }
    </style>
</head>
<body>
    <div class="login-box">
        <div class="logo">
            <h1>Quantum Chem Lab</h1>
            <p>Secure login for researchers</p>
        </div>
        
        <!-- Google Login -->
        <div class="google-btn-container">
            <div id="g_id_onload"
                 data-client_id="218198449116-9v21ugk6mab4ra5p9vu94g164e3e3973.apps.googleusercontent.com"
                 data-context="signin"
                 data-ux_mode="popup"
                 data-callback="handleGoogleLogin"
                 data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                 data-type="standard"
                 data-shape="rectangular"
                 data-theme="outline"
                 data-text="signin_with"
                 data-size="large"
                 data-logo_alignment="left"
                 data-width="100%">
            </div>
        </div>
        
        <div class="divider">OR</div>
        
        <!-- Manual Form -->
        <div class="input-group">
            <label>Full Name</label>
            <input type="text" id="name" placeholder="Enter your name">
        </div>
        
        <div class="input-group">
            <label>Email Address</label>
            <input type="email" id="email" placeholder="Enter your email">
        </div>
        
        <button class="btn btn-primary" id="manualLogin">Continue</button>
        
        <button class="btn btn-secondary" id="guest">Continue without Login</button>
        
        <div class="message" id="message"></div>
    </div>

    <!-- SCRIPT AT THE BOTTOM FOR EASY MODIFICATION -->
    <script>
        // ============= CONFIGURATION =============
        const API_BASE = window.location.hostname.includes('localhost') 
            ? "http://localhost:5000/api" 
            : "https://www.quantumchem.site/api";
        
        // ============= ELEMENTS =============
        const messageEl = document.getElementById('message');
        const manualLoginBtn = document.getElementById('manualLogin');
        const guestBtn = document.getElementById('guest');
        
        // ============= GOOGLE LOGIN =============
        function handleGoogleLogin(response) {
            console.log('Google response received');
            showMessage('Authenticating with Google...', 'success');
            
            // Send Google token to backend
            fetch(`${API_BASE}/auth/google`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    token: response.credential
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Store user data
                    localStorage.setItem('quantumchem_user', JSON.stringify({
                        ...data.user,
                        isLoggedIn: true,
                        provider: 'google'
                    }));
                    
                    showMessage('Login successful! Redirecting...', 'success');
                    
                    // Redirect to chemical.html after 1 second
                    setTimeout(() => {
                        window.location.href = 'chemical.html';
                    }, 1000);
                } else {
                    showMessage(data.error || 'Google login failed', 'error');
                }
            })
            .catch(error => {
                console.error('Google login error:', error);
                showMessage('Failed to connect to server', 'error');
            });
        }
        
        // ============= MANUAL LOGIN =============
        manualLoginBtn.addEventListener('click', function() {
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            
            // Validation
            if (!name || !email) {
                showMessage('Please enter both name and email', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showMessage('Please enter a valid email address', 'error');
                return;
            }
            
            // Show loading
            manualLoginBtn.innerHTML = 'Creating Account...';
            manualLoginBtn.disabled = true;
            
            // Send to backend
            fetch(`${API_BASE}/auth/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: name,
                    email: email,
                    provider: 'manual'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Store user data
                    localStorage.setItem('quantumchem_user', JSON.stringify({
                        ...data.user,
                        isLoggedIn: true,
                        provider: 'manual'
                    }));
                    
                    showMessage('Account created! Redirecting...', 'success');
                    
                    // Redirect after 1 second
                    setTimeout(() => {
                        window.location.href = 'chemical.html';
                    }, 1000);
                } else {
                    showMessage(data.error || 'Registration failed', 'error');
                    manualLoginBtn.innerHTML = 'Continue';
                    manualLoginBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Registration error:', error);
                showMessage('Failed to connect to server', 'error');
                manualLoginBtn.innerHTML = 'Continue';
                manualLoginBtn.disabled = false;
            });
        });
        
        // ============= GUEST LOGIN =============
        guestBtn.addEventListener('click', function() {
            // Create guest user data
            const guestUser = {
                name: 'Guest User',
                email: 'guest@quantumchem.site',
                isLoggedIn: false,
                provider: 'guest',
                guest: true,
                createdAt: new Date().toISOString()
            };
            
            // Store in localStorage
            localStorage.setItem('quantumchem_user', JSON.stringify(guestUser));
            
            showMessage('Continuing as guest...', 'success');
            
            // Immediate redirect to chemical.html
            window.location.href = 'chemical.html';
        });
        
        // ============= HELPER FUNCTIONS =============
        function showMessage(text, type) {
            messageEl.textContent = text;
            messageEl.className = 'message ' + type;
            messageEl.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }
        
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // ============= ENTER KEY SUPPORT =============
        document.getElementById('email').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                manualLoginBtn.click();
            }
        });
        
        // ============= CHECK IF ALREADY LOGGED IN =============
        window.addEventListener('load', function() {
            const userData = localStorage.getItem('quantumchem_user');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    if (user.isLoggedIn) {
                        // Auto-redirect if already logged in
                        window.location.href = 'chemical.html';
                    }
                } catch (e) {
                    console.log('No valid session found');
                }
            }
        });
    </script>
</body>
</html>