<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Account Information - Profile</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }
    
    body {
      background-color: #0F123D;
      color: #FFFFFF;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
    }
    
    /* Header Styling */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px 0;
      border-bottom: 1px solid rgba(107, 99, 241, 0.2);
    }
    
    .logo {
      font-size: 28px;
      font-weight: 700;
      color: #FFFFFF;
      text-decoration: none;
    }
    
    .logo span {
      color: #6B63F1;
    }
    
    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6B63F1, #8a84f5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 20px;
      color: white;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .user-avatar:hover {
      transform: scale(1.05);
    }
    
    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }
    
    /* Loading State */
    .loading {
      text-align: center;
      padding: 40px;
      color: #a0a0d0;
    }
    
    .spinner {
      border: 4px solid rgba(107, 99, 241, 0.3);
      border-top: 4px solid #6B63F1;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Main Content */
    .profile-container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 768px) {
      .profile-container {
        grid-template-columns: 1fr;
      }
    }
    
    /* Sidebar Navigation */
    .sidebar {
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(107, 99, 241, 0.1);
      height: fit-content;
    }
    
    .nav-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #6B63F1;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .nav-title i {
      font-size: 20px;
    }
    
    .nav-links {
      list-style: none;
    }
    
    .nav-links li {
      margin-bottom: 15px;
    }
    
    .nav-links a {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: #FFFFFF;
      padding: 12px 15px;
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .nav-links a:hover, .nav-links a.active {
      background-color: rgba(107, 99, 241, 0.15);
      color: #6B63F1;
    }
    
    .nav-links i {
      width: 20px;
      text-align: center;
    }
    
    /* Profile Content */
    .profile-content {
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 30px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(107, 99, 241, 0.1);
    }
    
    .profile-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(107, 99, 241, 0.2);
    }
    
    .profile-avatar-large {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 3px solid #6B63F1;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .profile-avatar-large:hover {
      transform: scale(1.05);
    }
    
    .profile-avatar-large img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .profile-avatar-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px;
      text-align: center;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .profile-avatar-large:hover .profile-avatar-overlay {
      opacity: 1;
    }
    
    .profile-info-header {
      flex: 1;
    }
    
    .profile-title {
      font-size: 26px;
      font-weight: 700;
      color: #FFFFFF;
      margin-bottom: 5px;
    }
    
    .profile-title span {
      color: #6B63F1;
    }
    
    .profile-email {
      color: #a0a0d0;
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .provider-badge {
      display: inline-block;
      background-color: rgba(107, 99, 241, 0.2);
      color: #6B63F1;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .edit-btn {
      background-color: rgba(107, 99, 241, 0.2);
      color: #6B63F1;
      border: 1px solid #6B63F1;
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }
    
    .edit-btn:hover {
      background-color: #6B63F1;
      color: #FFFFFF;
    }
    
    /* Account Info Styling */
    .account-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 25px;
      margin-bottom: 40px;
    }
    
    @media (max-width: 600px) {
      .account-info {
        grid-template-columns: 1fr;
      }
    }
    
    .info-card {
      background-color: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid #6B63F1;
    }
    
    .info-label {
      font-size: 14px;
      color: #a0a0d0;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .info-value {
      font-size: 18px;
      font-weight: 600;
      color: #FFFFFF;
    }
    
    .activity-status {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      background-color: rgba(46, 204, 113, 0.15);
      color: #2ecc71;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-top: 5px;
    }
    
    .activity-status::before {
      content: "";
      width: 8px;
      height: 8px;
      background-color: #2ecc71;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .activity-status.offline {
      background-color: rgba(231, 76, 60, 0.15);
      color: #e74c3c;
    }
    
    .activity-status.offline::before {
      background-color: #e74c3c;
    }
    
    /* Activity & Timestamps */
    .activity-section {
      margin-top: 30px;
    }
    
    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: #FFFFFF;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .timestamps {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
    
    .timestamp-card {
      background-color: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      padding: 20px;
    }
    
    .timestamp-label {
      font-size: 14px;
      color: #a0a0d0;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .timestamp-value {
      font-size: 18px;
      font-weight: 600;
      color: #FFFFFF;
    }
    
    .date-badge {
      display: inline-block;
      background-color: rgba(107, 99, 241, 0.15);
      color: #6B63F1;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 14px;
      margin-top: 8px;
    }
    
    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    
    .action-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .action-btn-primary {
      background: linear-gradient(135deg, #6B63F1, #8a84f5);
      color: white;
    }
    
    .action-btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .action-btn-danger {
      background: rgba(231, 76, 60, 0.2);
      color: #e74c3c;
      border: 1px solid rgba(231, 76, 60, 0.5);
    }
    
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    /* Footer */
    .footer {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(107, 99, 241, 0.2);
      color: #a0a0d0;
      font-size: 14px;
      width: 100%;
    }
    
    /* Modal for avatar change */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: #1a1f3c;
      padding: 30px;
      border-radius: 20px;
      max-width: 500px;
      width: 90%;
      border: 1px solid rgba(107, 99, 241, 0.3);
    }
    
    .modal-title {
      color: white;
      margin-bottom: 20px;
      font-size: 24px;
    }
    
    .modal-input {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(107, 99, 241, 0.3);
      border-radius: 8px;
      color: white;
      margin-bottom: 20px;
      font-size: 16px;
    }
    
    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }
      
      .profile-header {
        flex-direction: column;
        text-align: center;
        gap: 20px;
      }
      
      .action-buttons {
        justify-content: center;
      }
      
      .action-btn {
        flex: 1;
        min-width: 200px;
        justify-content: center;
      }
    }
    
    @media (max-width: 480px) {
      .action-btn {
        width: 100%;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <a href="index.html" class="logo">QuantumChem<span>Lab</span></a>
      <div class="user-avatar" id="userAvatar" onclick="window.location.href='profile.html'">
        <!-- Avatar will be set by JavaScript -->
      </div>
    </div>
    
    <!-- Loading State -->
    <div class="loading" id="loadingState">
      <div class="spinner"></div>
      <p>Loading profile data...</p>
    </div>
    
    <!-- Main Content (Initially Hidden) -->
    <div class="profile-container" id="profileContent" style="display: none;">
      <!-- Sidebar Navigation -->
      <div class="sidebar">
        <h3 class="nav-title"><i class="fas fa-user-circle"></i> Navigation</h3>
        <ul class="nav-links">
          <li><a href="index.html" id="homeLink"><i class="fas fa-home"></i> Back to Home</a></li>
          <li><a href="#" id="editLink" class="active"><i class="fas fa-user"></i> My Profile</a></li>
          <li><a href="#" id="settingsLink"><i class="fas fa-cog"></i> Settings</a></li>
          <li><a href="#" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
      </div>
      
      <!-- Profile Content -->
      <div class="profile-content">
        <div class="profile-header">
          <div class="profile-avatar-large" onclick="changeAvatar()">
            <img id="profileAvatarLarge" src="" alt="Profile Avatar">
            <div class="profile-avatar-overlay">
              <i class="fas fa-camera"></i> Change
            </div>
          </div>
          <div class="profile-info-header">
            <h1 class="profile-title" id="profileName">Loading...</h1>
            <p class="profile-email" id="profileEmail">Loading...</p>
            <span class="provider-badge" id="providerBadge">Loading...</span>
            <button class="edit-btn" onclick="editProfile()">
              <i class="fas fa-edit"></i> Edit Profile
            </button>
          </div>
        </div>
        
        <!-- Account Information -->
        <div class="account-info">
          <div class="info-card">
            <div class="info-label"><i class="fas fa-id-card"></i> User ID</div>
            <div class="info-value" id="userId">Loading...</div>
          </div>
          
          <div class="info-card">
            <div class="info-label"><i class="fas fa-calendar-plus"></i> Account Created</div>
            <div class="info-value" id="accountCreated">Loading...</div>
          </div>
          
          <div class="info-card">
            <div class="info-label"><i class="fas fa-sign-in-alt"></i> Login Method</div>
            <div class="info-value" id="loginMethod">Loading...</div>
          </div>
          
          <div class="info-card">
            <div class="info-label"><i class="fas fa-clock"></i> Last Login</div>
            <div class="info-value" id="lastLogin">Loading...</div>
          </div>
        </div>
        
        <!-- Activity Status -->
        <div class="activity-section">
          <h3 class="section-title"><i class="fas fa-chart-line"></i> Activity Status</h3>
          <div class="info-card">
            <div class="info-label"><i class="fas fa-circle"></i> Current Status</div>
            <div class="info-value">
              <span id="activityStatus">Loading...</span>
              <span class="activity-status" id="onlineStatus">Online</span>
            </div>
            <div class="date-badge" id="lastActive">...</div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <a href="index.html" class="action-btn action-btn-primary">
            <i class="fas fa-home"></i> Go to Dashboard
          </a>
          <button onclick="changeAvatar()" class="action-btn action-btn-secondary">
            <i class="fas fa-camera"></i> Change Avatar
          </button>
          <button onclick="logout()" class="action-btn action-btn-danger">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>
    </div>
    
    <!-- Avatar Change Modal -->
    <div id="avatarModal" class="modal">
      <div class="modal-content">
        <h3 class="modal-title">Change Profile Picture</h3>
        <input type="url" id="avatarUrlInput" class="modal-input" 
               placeholder="Enter image URL (e.g., https://example.com/photo.jpg)">
        <p style="color: #a0a0d0; margin-bottom: 20px; font-size: 14px;">
          Tip: You can upload to image hosting services like Imgur or use a Gravatar email
        </p>
        <div class="modal-buttons">
          <button onclick="saveAvatar()" class="action-btn action-btn-primary">
            Save Changes
          </button>
          <button onclick="closeAvatarModal()" class="action-btn action-btn-secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
      <p>&copy; 2023 QuantumChem Lab. All rights reserved.</p>
    </div>
  </div>
  
  <!-- Import profile-manager.js -->
  <script src="profile-manager.js"></script>
  
  <script>
    // ===========================================
    // MAIN PROFILE FUNCTIONS
    // ===========================================
    async function loadProfile() {
      const user = ProfileManager.getCurrentUser();
      const loadingState = document.getElementById('loadingState');
      const profileContent = document.getElementById('profileContent');
      
      if (!user) {
        // User not logged in
        loadingState.innerHTML = `
          <div style="text-align: center;">
            <i class="fas fa-user-slash" style="font-size: 48px; color: #6B63F1; margin-bottom: 20px;"></i>
            <h2 style="color: white; margin-bottom: 10px;">You are not logged in</h2>
            <p style="color: #a0a0d0; margin-bottom: 20px;">Please login to view your profile</p>
            <a href="login.html" class="action-btn action-btn-primary">
              <i class="fas fa-sign-in-alt"></i> Go to Login
            </a>
          </div>
        `;
        return;
      }
      
      // Hide loading, show content
      loadingState.style.display = 'none';
      profileContent.style.display = 'grid';
      
      // Format dates
      const createdDate = new Date(user.createdAt).toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      
      const lastLoginDate = new Date(user.lastLogin).toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric'
      });
      
      const lastLoginTime = new Date(user.lastLogin).toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit'
      });
      
      const lastActiveAgo = getTimeAgo(new Date(user.lastLogin));
      
      // Update UI elements
      document.getElementById('profileName').textContent = user.name;
      document.getElementById('profileEmail').textContent = user.email;
      document.getElementById('providerBadge').textContent = user.provider === 'google' ? 'Google Account' : 'Manual Account';
      document.getElementById('userId').textContent = user.uid || 'N/A';
      document.getElementById('accountCreated').textContent = createdDate;
      document.getElementById('loginMethod').textContent = user.provider === 'google' ? 'Google OAuth' : 'Email/Password';
      document.getElementById('lastLogin').textContent = `${lastLoginDate} at ${lastLoginTime}`;
      document.getElementById('activityStatus').textContent = 'Active now';
      document.getElementById('lastActive').textContent = `Last active ${lastActiveAgo}`;
      
      // Update profile avatar
      const profileAvatar = document.getElementById('profileAvatarLarge');
      const userAvatar = document.getElementById('userAvatar');
      const avatarUrl = user.photoURL || ProfileManager.getProfilePicture(user.name);
      
      profileAvatar.src = avatarUrl;
      profileAvatar.onerror = function() {
        this.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=6366f1&color=fff&size=256`;
      };
      
      // Update header avatar
      const nameParts = user.name.split(' ');
      const initials = (nameParts[0].charAt(0) + (nameParts[1] ? nameParts[1].charAt(0) : '')).toUpperCase();
      
      userAvatar.innerHTML = `
        <img src="${avatarUrl}" alt="${user.name}" 
             onerror="this.parentElement.innerHTML='${initials}'; this.parentElement.style.background='linear-gradient(135deg, #6B63F1, #8a84f5)';">
      `;
    }
    
    function editProfile() {
      const user = ProfileManager.getCurrentUser();
      if (!user) return;
      
      const newName = prompt("Enter new name:", user.name);
      if (newName && newName.trim() !== '') {
        const updatedUser = {
          ...user,
          name: newName.trim(),
          photoURL: user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(newName.trim())}&background=6366f1&color=fff&bold=true&size=256`
        };
        
        ProfileManager.saveUser(updatedUser);
        alert("Profile updated successfully!");
        loadProfile();
      }
    }
    
    function changeAvatar() {
      const modal = document.getElementById('avatarModal');
      modal.style.display = 'flex';
      
      // Set current avatar URL in input
      const user = ProfileManager.getCurrentUser();
      if (user && user.photoURL) {
        document.getElementById('avatarUrlInput').value = user.photoURL;
      } else {
        document.getElementById('avatarUrlInput').value = '';
      }
    }
    
    function closeAvatarModal() {
      document.getElementById('avatarModal').style.display = 'none';
    }
    
    function saveAvatar() {
      const imageUrl = document.getElementById('avatarUrlInput').value.trim();
      
      if (!imageUrl) {
        alert("Please enter a valid image URL");
        return;
      }
      
      // Basic URL validation
      try {
        new URL(imageUrl);
      } catch (e) {
        alert("Please enter a valid URL (include http:// or https://)");
        return;
      }
      
      const user = ProfileManager.getCurrentUser();
      if (user) {
        const updatedUser = { ...user, photoURL: imageUrl };
        ProfileManager.saveUser(updatedUser);
        alert("Avatar updated successfully!");
        closeAvatarModal();
        loadProfile();
      }
    }
    
    function logout() {
      if (confirm("Are you sure you want to logout?")) {
        ProfileManager.logout();
        window.location.href = 'login.html';
      }
    }
    
    function getTimeAgo(date) {
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 1) {
        return "just now";
      } else if (diffMins < 60) {
        return `${diffMins} ${diffMins === 1 ? 'minute' : 'minutes'} ago`;
      } else if (diffHours < 24) {
        return `${diffHours} ${diffHours === 1 ? 'hour' : 'hours'} ago`;
      } else {
        return `${diffDays} ${diffDays === 1 ? 'day' : 'days'} ago`;
      }
    }
    
    // ===========================================
    // EVENT LISTENERS
    // ===========================================
    document.addEventListener('DOMContentLoaded', function() {
      // Load profile when page loads
      loadProfile();
      
      // Setup navigation links
      document.getElementById('logoutLink').addEventListener('click', function(e) {
        e.preventDefault();
        logout();
      });
      
      document.getElementById('settingsLink').addEventListener('click', function(e) {
        e.preventDefault();
        alert("Settings page would open here");
      });
      
      // Close modal when clicking outside
      window.addEventListener('click', function(event) {
        const modal = document.getElementById('avatarModal');
        if (event.target === modal) {
          closeAvatarModal();
        }
      });
      
      // Close modal with Escape key
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          closeAvatarModal();
        }
      });
    });
  </script>
</body>
</html>